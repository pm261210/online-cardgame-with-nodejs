<%- include('partials/header') %>

<div class="container py-5">
  <h2>Conectando ao jogo...</h2>
  <p id="status">Procurando oponente...</p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  let game = null;
  let playerId = null;

  socket.on('waitingForOpponent', () => {
    const el = document.getElementById('status');
    if (el) el.innerText = 'Esperando outro jogador...';
  });

  socket.on('gameStart', ({ roomId, state, players}) => {
    // guarda info e redireciona para a partida
    try {
      localStorage.setItem('roomId', roomId);
      const mySocketId = Object.keys(players).find(k => players[k] && players[k].id);
    } catch (e) {
      // ignore
    }
    window.location.href = `/match/${roomId}`;
  });

  socket.on('playerDisconnected', () => {
    alert('O outro jogador desconectou.');
    window.location.href = '/';
  });

  socket.on('assignPlayerId', (id) => {
    localStorage.setItem('playerId', id);
    playerId = id;
  });
</script>

<%- include('partials/footer') %>

